#compdef stock kv site basket drop jam pantry task

# --- 1. STOCK COMPLETION ---
_stock() {
    local context state state_descr line
    typeset -A opt_args

    _arguments -C \
        '1: :->cmds' \
        '*:: :->args'

    case $state in
        cmds)
            local -a commands
            commands=(
                'set:Store JSON/Config (Usage: set key value|@file)'
                'get:Retrieve item (Usage: get key [.filter])'
                'ls:Interactive Explorer & List'
                'rm:Delete an item'
            )
            _describe 'command' commands
            ;;
        args)
            case $line[1] in
                set)
                    _arguments \
                        '1:Key Name (e.g. app.config)' \
                        '2:Value or File:_files'
                    ;;
                get|rm)
                    # Advanced: We could fetch keys dynamically, but let's keep it fast
                    _message "Key Name (e.g. app.config)"
                    ;;
            esac
            ;;
    esac
}

# --- 2. SITE COMPLETION ---
_site() {
    local context state state_descr line
    typeset -A opt_args
    _arguments -C '1: :->cmds' '*:: :->args'

    case $state in
        cmds)
            local -a commands
            commands=(
                'deploy:Upload site to Cloud (Usage: deploy ./dist name)'
                'ls:List active projects'
                'rm:Delete a project'
            )
            _describe 'command' commands
            ;;
        args)
            case $line[1] in
                deploy)
                    _arguments \
                        '1:Local Folder:_files -/' \
                        '2:Project Name (Subdomain)'
                    ;;
                rm)
                    # Helper to grab project names from Rclone for completion
                    # (Only works if internet is fast, uncomment to enable)
                    # local -a projects
                    # projects=($(rclone lsf oracle:website --dirs-only 2>/dev/null | sed "s/\///g"))
                    # _describe 'projects' projects
                    _message "Project Name"
                    ;;
            esac
            ;;
    esac
}

# --- 3. BASKET COMPLETION ---
_basket() {
    local context state state_descr line
    typeset -A opt_args
    _arguments -C '1: :->cmds' '*:: :->args'

    case $state in
        cmds)
            local -a commands
            commands=(
                'ls:List files in bucket'
                'push:Upload file (Usage: push file.txt)'
                'pull:Download file (Interactive)'
                'rm:Delete file'
                'link:Generate public share link'
            )
            _describe 'command' commands
            ;;
        args)
            case $line[1] in
                push) _arguments '1:Local File:_files' ;;
                *) _message "Remote File" ;;
            esac
            ;;
    esac
}

# --- 4. KV COMPLETION ---
_kv() {
    local context state state_descr line
    typeset -A opt_args
    _arguments -C '1: :->cmds' '*:: :->args'

    case $state in
        cmds)
            local -a commands
            commands=(
                'set:Save text (Usage: set key val)'
                'get:Get text (Usage: get key)'
                'ls:List all keys'
                'rm:Remove key'
            )
            _describe 'command' commands
            ;;
        args)
            case $line[1] in
                set) _arguments '1:Key' '2:Value' ;;
                *) _message "Key" ;;
            esac
            ;;
    esac
}

# --- 5. DROP COMPLETION ---
_drop() {
    _arguments '1:File to upload:_files'
}

# --- 6. JAM/PANTRY (Simple) ---
_jam() { _arguments '1:SQL Query or DB Name' }
_pantry() { _arguments '1:SQL Query' }

# --- 7. TASK COMPLETION ---
_task() {
    local context state state_descr line
    typeset -A opt_args
    _arguments -C '1: :->cmds' '*:: :->args'

    case $state in
        cmds)
            local -a commands
            commands=(
                'add:Add a new task'
                'ls:List pending tasks'
                'done:Mark task as completed'
                'clean:Remove completed tasks'
            )
            _describe 'command' commands
            ;;
        args)
            case $line[1] in
                add) _message "Task Description" ;;
                done) _message "Task ID (Optional)" ;;
            esac
            ;;
    esac
}

# Route the completion to the correct function based on the command
case "$service" in
    stock) _stock ;;
    site) _site ;;
    basket) _basket ;;
    kv) _kv ;;
    drop) _drop ;;
    jam) _jam ;;
    pantry) _pantry ;;
    task) _task ;;
esac
